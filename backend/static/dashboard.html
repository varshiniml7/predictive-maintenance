<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Predictor — With Integrated Compressor Sketch (Preview)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0f1724; 
      --card:#0b1220; 
      --muted:#9aa4b2;
      --accent1:#6ee7b7;
      --accent2:#3b82f6;
      --accent3:#8b5cf6;
      --danger:#ef4444;
    }

    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system;
      background:var(--bg);
      color:#e6eef8;
    }

    .wrap{max-width:1100px;margin:28px auto;padding:20px}

    header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
    .logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,#6ee7b7,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021124}

    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:480px 1fr;gap:18px}

    .card{
      background:rgba(255,255,255,0.04);
      border-radius:14px;
      padding:18px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 8px 30px rgba(0,0,0,0.4);
    }

    label{font-size:12px;color:var(--muted)}
    input[type=number]{
      width:100%;
      padding:10px;
      background:transparent;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      color:white;
      font-size:14px;
      outline:none;
      transition:.2s;
    }
    input[type=number]:focus{
      border-color:#3b82f6;
      box-shadow:0 0 12px #3b82f6;
    }

    .warning-inline{display:none;color:var(--danger);font-size:12px;margin-top:4px}

    .btn{
      padding:10px 14px;
      border-radius:12px;
      background:linear-gradient(90deg,#3b82f6,#8b5cf6);
      color:white;
      font-weight:700;
      border:none;
      cursor:pointer;
    }

    .status{margin-top:14px;padding:12px;border-radius:10px;display:flex;gap:12px}
    .normal{background:rgba(34,197,94,0.1);border-left:6px solid #22c55e}
    .anomaly{background:rgba(239,68,68,0.1);border-left:6px solid #ef4444}

    /* Sketch styling */
    .sketch-wrap{
      margin-top:20px;
      padding:14px;
      border-radius:12px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.06);
      text-align:center;
    }

    svg{width:100%;height:auto;max-width:100%;margin:auto;display:block} 

    .sketch-line{
      stroke:url(#neonStroke);
      stroke-width:2;
      fill:none;
      stroke-linecap:round;
      stroke-linejoin:round;
      filter:url(#glowFilter);
    }

    .sensor-dot{
      stroke:url(#neonStroke);
      stroke-width:2;
      fill:var(--accent2);
      filter:url(#glowFilter);
      transition:.2s;
    }

    .sensor-dot.alert{
      fill:var(--danger) !important;
      stroke:var(--danger) !important;
      filter:none !important;
    }

  .sensor-label{font-size:14px;fill:#ffffff;font-weight:800;text-shadow:0 0 6px #3b82f6,0 0 10px #8b5cf6;text-anchor:start}
    .prob-percent{font-size:18px;font-weight:700;text-align:center;margin-top:6px}

</style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <header>
    <div class="logo">PX</div>
    <div>
      <h1>Failure Predictor — Preview</h1>
      <p class="lead">Integrated compressor visualization with live alerts.</p>
    </div>
  </header>

  <!-- GRID -->
  <div class="grid">

    <!-- LEFT CARD (FORM + SKETCH INSERTED HERE) -->
    <div class="card">

      <form id="predictForm" onsubmit="event.preventDefault(); predictInline();">
        <div style="display:flex;justify-content:space-between;margin-bottom:10px">
          <div style="font-weight:700">Enter sensor values</div>
          <div class="muted">ranges included</div>
        </div>

        <div class="form-grid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">

          <div>
            <label>TP2</label>
            <input id="tp2" type="number" step="0.001">
            <div id="tp2_warn" class="warning-inline">Out of range (N: -7.7 / 9.7)</div>
          </div>

          <div>
            <label>TP3</label>
            <input id="tp3" type="number" step="0.001">
            <div id="tp3_warn" class="warning-inline">Out of range (N: 6.8 / 11.1)</div>
          </div>

          <div>
            <label>H1</label>
            <input id="h1" type="number" step="0.001">
            <div id="h1_warn" class="warning-inline">Out of range (N: -0.9 / 16.8)</div>
          </div>

          <div>
            <label>Oil Temperature</label>
            <input id="oil_temp" type="number" step="0.001">
            <div id="oil_temp_warn" class="warning-inline">Out of range (N: 47.8 / 84.7)</div>
          </div>

          <div>
            <label>DV Pressure</label>
            <input id="dv_pressure" type="number" step="0.001">
            <div id="dv_pressure_warn" class="warning-inline">Out of range (N: -0.58 / 0.545)</div>
          </div>

          <div style="display:flex;justify-content:flex-end;align-items:flex-end">
            <button id="inlinePredict" class="btn" type="submit" disabled>PREDICT</button>
          </div>
        </div>

        <div id="result"></div>
      </form>

      <!-- ************************ -->
      <!--  COMPRESSOR SKETCH HERE -->
      <!-- ************************ -->
      <!-- RIGHT CARD (moved here) -->
    <div class="card chart-wrap">
      <div style="display:flex;align-items:center;gap:14px;justify-content:space-between">
        <div>
          <div style="font-weight:700">2‑month failure probability</div>
          <div class="muted">Animated gauge + trend</div>
        </div>
        <div style="font-size:12px;color:var(--muted);text-align:right">Backend → <span id="backendStatus">—</span></div>
      </div>

      <canvas id="probChart" width="110" height="110" style="max-width:110px;margin-top:4px;display:block;margin-left:auto;margin-right:auto">></canvas>
      <div class="prob-percent" id="probPercent">—%</div>
      <div class="muted" id="probLabel">No prediction yet</div>

      <div style="width:100%;display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button class="btn" id="simulateBtn" onclick="simulateExample()">Try example</button>
        <button class="btn" style="background:linear-gradient(90deg,#06b6d4,#3b82f6)" onclick="clearForm()">Reset</button>
      </div>
    </div>

    <!-- end moved right card -->
</div>

    <!-- Sketch + Recent (moved here) -->
    <div class="card">
      <div style="display:flex;gap:8px;align-items:center;margin-top:14px">
        <button id="tab_sketch_btn" class="btn" style="background:linear-gradient(90deg,#3b82f6,#8b5cf6);padding:8px 12px;">Sketch</button>
        <button id="tab_recent_btn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;color:var(--muted);">Recent</button>
      </div>

      <div class="sketch-wrap" id="tab_sketch" style="display:block">

        <svg viewBox="0 0 1200 720">

          <defs>
            <!-- Neon Gradient Stroke -->
            <linearGradient id="neonStroke" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#6ee7b7"/>
              <stop offset="50%" stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#8b5cf6"/>
            </linearGradient>

            <!-- Glow -->
            <filter id="glowFilter">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>

          <!-- Base I-beam -->
          <g transform="translate(60,420)">
            <path class="sketch-line" d="M0 150 L1050 150 L1050 210 L0 210 Z"/>
            <path class="sketch-line" d="M20 150 L140 60 L920 60 L1040 150"/>
            <g stroke-linecap="round">
              <rect x="120" y="20" width="160" height="40" class="sketch-line"/>
              <rect x="420" y="20" width="160" height="40" class="sketch-line"/>
            </g>
          </g>

          <!-- Block -->
          <g transform="translate(90,120)">
            <rect x="0" y="200" width="320" height="170" rx="14" fill="transparent" stroke="url(#neonStroke)" stroke-width="1.6"/>
            <path class="sketch-line" d="M10 220 q60 -20 140 0 t160 0" />
            <g class="sketch-line" stroke-width="1.8">
              <path d="M40 180 q40 -18 240 0"/>
              <path d="M34 165 q44 -18 248 0"/>
              <path d="M28 150 q48 -18 256 0"/>
            </g>
            <g>
              <rect x="60" y="62" width="200" height="84" rx="14" fill="transparent" stroke="url(#neonStroke)" stroke-width="1.6"/>
              <path class="sketch-line" d="M70 70 q50 -28 180 0" />
            </g>

            <!-- small bolt details (non-interactive) -->
            <circle cx="110" cy="282" r="6" fill="#021124" stroke="url(#neonStroke)" stroke-width="1.6"/>
            <circle cx="260" cy="282" r="6" fill="#021124" stroke="url(#neonStroke)" stroke-width="1.6"/>

            <!-- H1 hole on side (sensor) -->
            <g transform="translate(0,240)">
              <circle id="h1_dot" cx="12" cy="50" r="10" class="sensor-dot"/><text id="h1_label" x="36" y="54" class="sensor-label">H1</text>
            </g>
          </g>

          <!-- Motor -->
          <g transform="translate(460,220)">
            <ellipse cx="260" cy="140" rx="150" ry="140" fill="transparent" stroke="url(#neonStroke)" stroke-width="1.6"/>
            <path class="sketch-line" d="M80 70 L420 70"/>

            <!-- Oil temperature port (sensor) -->
            <g transform="translate(360,180)">
              <circle id="oil_dot" cx="0" cy="0" r="12" class="sensor-dot"/><text id="oil_label" x="18" y="6" class="sensor-label">Oil Temp</text>
            </g>

            <!-- DV_pressure port on top-right of motor (sensor) -->
            <g transform="translate(480,60)">
              <circle id="dv_pressure_dot" cx="0" cy="0" r="12" class="sensor-dot"/>
              <text id="dv_label" x="28" y="6" class="sensor-label">DV_pressure</text>
            </text>
            </g>
          </g>

          <!-- connecting bracket and shaft area -->
          <g transform="translate(330,170)">
            <path class="sketch-line" d="M0 120 q40 -20 90 -20 q260 0 320 22"/>
            <rect x="30" y="-8" width="48" height="140" rx="8" fill="transparent" stroke="url(#neonStroke)" stroke-width="1.6"/>
          </g>

          <line x1="370" y1="465" x2="370" y2="620" stroke="url(#neonStroke)" stroke-width="2"/>

          <!-- TP2 and TP3 sensor callouts (sensors) -->
          <g>
            <!-- TP2 -->
            <circle id="tp2_dot" cx="180" cy="190" r="10" class="sensor-dot"/><text id="tp2_label" x="200" y="184" class="sensor-label">TP2</text>

            <!-- TP3 -->
            <circle id="tp3_dot" cx="300" cy="220" r="10" class="sensor-dot"/><text id="tp3_label" x="322" y="214" class="sensor-label">TP3</text>
          </g>

        </svg>
      </div>

      <!-- RECENT VALUES TAB (hidden by default) -->
      <div class="sketch-wrap" id="tab_recent" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:700">Recent entries</div>
          <div style="display:flex;gap:8px">
            <button id="loadRecentBtn" class="btn" style="background:linear-gradient(90deg,#06b6d4,#3b82f6)">Load Selected</button>
            <button id="clearRecentBtn" class="btn" style="background:linear-gradient(90deg,#ef4444,#8b5cf6)">Clear</button>
          </div>
        </div>
        <div id="recentList" style="max-height:220px;overflow:auto;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)">
          <!-- recent items inserted here -->
        </div>
        <div style="margin-top:8px;color:var(--muted);font-size:12px">Click an entry to select it, then press <strong>Load Selected</strong> to populate the form.</div>
      </div>

    </div>
</div>
</div>

<script>
// NORMAL RANGES
const RANGES = {
  tp2: {min:-7.73,max:9.75},
  tp3: {min:6.82,max:11.12},
  h1: {min:-0.91,max:16.81},
  oil_temp:{min:47.84,max:84.73},
  dv_pressure:{min:-0.58,max:0.545}
};

function inRange(key,v){ if(v===''||v===null||Number.isNaN(Number(v))) return false; const r=RANGES[key]; return Number(v)>=r.min && Number(v)<=r.max }

// enable predict button when all filled
const fields = ['tp2','tp3','h1','oil_temp','dv_pressure'];
function updatePredictButtonState(){ const btn=document.getElementById('inlinePredict'); let all=true; fields.forEach(id=>{ if(document.getElementById(id).value==='') all=false }); btn.disabled = !all; }
fields.forEach(id=>document.getElementById(id).addEventListener('input', ()=>{ updatePredictButtonState(); updateSketchIndicators(); checkWarningsForInline(); }));
updatePredictButtonState();

function updateSketchIndicators(){
  const map = { tp2: 'tp2_dot', tp3:'tp3_dot', h1:'h1_dot', oil_temp:'oil_dot', dv_pressure:'dv_pressure_dot' };
  const labelMap = { tp2: 'tp2_label', tp3: 'tp3_label', h1: 'h1_label', oil_temp: 'oil_label', dv_pressure: 'dv_label' };
  const DISPLAY_RANGES = {
    tp2: '-7.7 / 9.7',
    tp3: '6.8 / 11.1',
    h1: '-0.9 / 16.8',
    oil_temp: '47.8 / 84.7',
    dv_pressure: '-0.58 / 0.545'
  };

  Object.keys(map).forEach(k=>{
    const el = document.getElementById(map[k]);
    const label = document.getElementById(labelMap[k]);
    const val = document.getElementById(k).value;
    const ok = inRange(k, val);
    if(ok) {
      el.classList.remove('alert');
      if(label) label.textContent = label.textContent.split(' (')[0];
    } else {
      el.classList.add('alert');
      if(label) label.textContent = (label.textContent.split(' (')[0]) + ' (N: ' + DISPLAY_RANGES[k] + ')';
    }
  });
}

function checkWarningsForInline(){
  fields.forEach(id=>{ const warn = document.getElementById(id+'_warn'); if(!inRange(id, document.getElementById(id).value)) warn.style.display='block'; else warn.style.display='none'; });
}

// Chart
const ctx = document.getElementById('probChart').getContext('2d');
const chart = new Chart(ctx, { type:'doughnut', data:{ datasets:[{ data:[0,100], backgroundColor:['rgba(139,92,246,0.95)','rgba(255,255,255,0.06)'], cutout:'75%'}]}, options:{plugins:{tooltip:{enabled:false},legend:{display:false}}}});

function isMidRangeFromForm(){
  // determine if all inputs are comfortably in the middle 25%-75% of their normal ranges
  try{
    const keys = ['tp2','tp3','h1','oil_temp','dv_pressure'];
    for(const k of keys){ const el = document.getElementById(k); if(!el) return false; const v = Number(el.value); if(Number.isNaN(v)) return false; const r = RANGES[k]; const norm = (v - r.min) / (r.max - r.min); if(norm < 0.25 || norm > 0.75) return false; }
    return true;
  }catch(e){return false}
}

function updateUIStatus(status, prob){
  const resultDiv=document.getElementById('result');
  resultDiv.style.display='block';
  const className = status==='Abnormal'?'anomaly':'normal';
  resultDiv.innerHTML = `<div class="status ${className}"><div style="flex:1"><h3>Status: ${status}</h3><div class="muted">${prob===null?'':('Probability: '+(prob*100).toFixed(1)+'% within 2 months')}</div></div></div>`;

  // compute displayed probability with frontend cap when readings are mid-range
  let rawProb = (prob===null) ? null : Number(prob);
  let displayProb = rawProb;
  const mid = isMidRangeFromForm();
  if(mid){
    // enforce a display range of 20% - 25% when all sensors sit in mid ranges
    if(rawProb === null || Number.isNaN(rawProb)) displayProb = 0.225; // default mid
    else displayProb = Math.max(0.20, Math.min(0.25, rawProb));
  }

  const percent = (displayProb===null || displayProb===undefined) ? 0 : Math.max(0, Math.min(1, displayProb));

  // update chart & right panel using displayProb rather than raw backend value
  chart.data.datasets[0].data[0] = percent*100; chart.data.datasets[0].data[1] = 100-percent*100;
  chart.update();
  document.getElementById('probPercent').textContent = (displayProb===null? '—' : (percent*100).toFixed(1)+'%');
  document.getElementById('probLabel').textContent = displayProb===null?'No prediction yet' : (percent>0.6? 'High risk' : (percent>0.3? 'Moderate risk' : 'Low risk')) }

// predictInline (keeps backend payload same as original)
async function predictInline(){
  const inputs = {
    tp2: document.getElementById('tp2').value,
    tp3: document.getElementById('tp3').value,
    h1: document.getElementById('h1').value,
    oil_temp: document.getElementById('oil_temp').value,
    dv_pressure: document.getElementById('dv_pressure').value
  };
  for(const k of fields){ if(inputs[k]==='' || inputs[k]===null || Number.isNaN(Number(inputs[k]))){ alert('Please fill all fields with numeric values.'); return; } }

  // UI: show contacting
  const resultDiv=document.getElementById('result'); resultDiv.style.display='block'; resultDiv.innerHTML = '<div class="muted">Contacting backend…</div>';

  const payload = { TP2: Number(inputs.tp2), TP3: Number(inputs.tp3), H1: Number(inputs.h1), Oil_temperature: Number(inputs.oil_temp), DV_pressure: Number(inputs.dv_pressure) };
  const inputHasOutliers = fields.some(k=>!inRange(k, Number(inputs[k])));

  // Use environment-based API URL or fallback to localhost for development
  const API_BASE_URL ="https://predictive-maintenance-i05f.onrender.com";
;
  const API_URL = API_BASE_URL + '/predict';
  
  try{
    const res = await fetch(API_URL,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    if(!res.ok) throw new Error('server '+res.status);
    const json = await res.json();
    const backendStatus = (json.status || '').toString();
    const prob2m = (typeof json.prob_within_2months === 'number')? json.prob_within_2months : null;
    let status = backendStatus || (inputHasOutliers? 'Abnormal':'Normal'); if(inputHasOutliers) status='Abnormal';
    document.getElementById('backendStatus').textContent = backendStatus || '—';
    updateUIStatus(status, prob2m);
  }catch(err){
    console.error('Prediction error',err);
    const fallback = inputHasOutliers? 'Abnormal':'Normal'; document.getElementById('backendStatus').textContent='offline'; updateUIStatus(fallback,null);
  }
}

function clearForm(){ fields.forEach(id=>{ document.getElementById(id).value=''; document.getElementById(id+'_warn').style.display='none'; }); updatePredictButtonState(); updateSketchIndicators(); document.getElementById('result').style.display='none'; document.getElementById('probPercent').textContent='—%'; document.getElementById('probLabel').textContent='No prediction yet'; document.getElementById('backendStatus').textContent='—'; }

function simulateExample(){ document.getElementById('tp2').value = 3.5; document.getElementById('tp3').value = 9.2; document.getElementById('h1').value = 5.8; document.getElementById('oil_temp').value = 72.1; document.getElementById('dv_pressure').value = 0.12; updatePredictButtonState(); updateSketchIndicators(); const btn=document.getElementById('inlinePredict'); btn.disabled=true; btn.textContent='Predicting…'; setTimeout(()=>{ btn.textContent='PREDICT'; btn.disabled=false; predictInline(); },700); }


// ----- Recent entries storage and UI -----
(function(){
  const RECENT_KEY = 'predictor_recent_entries_v1';
  function getRecent(){ try{ return JSON.parse(localStorage.getItem(RECENT_KEY) || '[]'); }catch(e){return []} }
  function setRecent(arr){ try{ localStorage.setItem(RECENT_KEY, JSON.stringify(arr)); }catch(e){} }
  window.saveRecentEntry = function(entry){ const list = getRecent(); list.unshift(entry); if(list.length>12) list.pop(); setRecent(list); renderRecentList(); };
  window.clearRecent = function(){ setRecent([]); renderRecentList(); };
  window.renderRecentList = function(){ const node = document.getElementById('recentList'); if(!node) return; const items = getRecent(); if(items.length===0){ node.innerHTML = '<div style="color:var(--muted)">No recent entries</div>'; return; } node.innerHTML = items.map((it,idx)=>{
      const time = new Date(it.ts).toLocaleString();
      return `<div class="recent-item" data-idx="${idx}" style="padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);cursor:pointer"><div style="display:flex;justify-content:space-between"><div style="font-weight:700">${it.status||'—'}</div><div style="font-size:12px;color:var(--muted)">${time}</div></div><div style="font-size:13px;margin-top:6px">TP2:${it.tp2} TP3:${it.tp3} H1:${it.h1} Oil:${it.oil_temp} DV:${it.dv_pressure}</div></div>`;
    }).join('');
    node.querySelectorAll('.recent-item').forEach(el=>el.addEventListener('click', ()=>{ node.querySelectorAll('.recent-item').forEach(x=>x.style.background=''); el.style.background='rgba(59,130,246,0.06)'; node.dataset.selected = el.getAttribute('data-idx'); }));
  };

  // wire tab buttons and actions
  document.addEventListener('DOMContentLoaded', ()=>{
    const sketchBtn = document.getElementById('tab_sketch_btn');
    const recentBtn = document.getElementById('tab_recent_btn');
    const sketchTab = document.getElementById('tab_sketch');
    const recentTab = document.getElementById('tab_recent');
    const loadBtn = document.getElementById('loadRecentBtn');
    const clearBtn = document.getElementById('clearRecentBtn');
    const recentList = document.getElementById('recentList');
    if(!sketchBtn||!recentBtn) return;
    sketchBtn.addEventListener('click', ()=>{ sketchTab.style.display='block'; recentTab.style.display='none'; sketchBtn.style.background='linear-gradient(90deg,#3b82f6,#8b5cf6)'; recentBtn.style.background='transparent'; recentBtn.style.color='var(--muted)'; });
    recentBtn.addEventListener('click', ()=>{ sketchTab.style.display='none'; recentTab.style.display='block'; recentBtn.style.background='linear-gradient(90deg,#3b82f6,#8b5cf6)'; sketchBtn.style.background='transparent'; sketchBtn.style.color='var(--muted)'; renderRecentList(); });
    if(loadBtn){ loadBtn.addEventListener('click', ()=>{
      const sel = recentList && recentList.dataset && recentList.dataset.selected;
      if(!sel && sel!=='0'){ alert('Select a recent entry first'); return; }
      const arr = getRecent(); const it = arr[Number(sel)]; if(!it) return; document.getElementById('tp2').value = it.tp2; document.getElementById('tp3').value = it.tp3; document.getElementById('h1').value = it.h1; document.getElementById('oil_temp').value = it.oil_temp; document.getElementById('dv_pressure').value = it.dv_pressure; updatePredictButtonState(); updateSketchIndicators();
    }); }
    if(clearBtn){ clearBtn.addEventListener('click', ()=>{ if(confirm('Clear recent entries?')){ clearRecent(); } }); }
    renderRecentList();

    // observe result area to auto-save entries after predict
    const resultDiv = document.getElementById('result');
    if(resultDiv){
      let last = resultDiv.innerHTML;
      new MutationObserver(()=>{
        if(resultDiv.innerHTML && resultDiv.innerHTML!==last){ last = resultDiv.innerHTML; // save current inputs
          const entry = {
            tp2: Number(document.getElementById('tp2').value) || null,
            tp3: Number(document.getElementById('tp3').value) || null,
            h1: Number(document.getElementById('h1').value) || null,
            oil_temp: Number(document.getElementById('oil_temp').value) || null,
            dv_pressure: Number(document.getElementById('dv_pressure').value) || null,
            status: (document.querySelector('#result .status h3')||{textContent:'—'}).textContent.replace('Status: ','') ,
            prob: (document.getElementById('probPercent')?document.getElementById('probPercent').textContent:'—'),
            ts: Date.now()
          };
          saveRecentEntry(entry);
        }
      }).observe(resultDiv, { childList:true, subtree:true, characterData:true });
    }
  });
})();

</script>
</body>
</html>
